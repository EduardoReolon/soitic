(function(){"use strict";var e={3174:function(e,t,r){var o=r(144),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("button",{on:{click:function(t){return e.goToHome()}}},[e._v("Página inicial")]),r("button",{on:{click:function(t){return e.goToMovies()}}},[e._v("Filmes")]),r("button",{on:{click:function(t){return e.goToDirectors()}}},[e._v("Diretores")]),r("router-view")],1)},n=[],s=r(8345),c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"login"},[r("h1",[e._v("Log-in")]),r("form",{on:{submit:e.requestLogin}},[e._m(0),e._m(1),r("input",{attrs:{type:"submit",value:"Log-in"}})])])},a=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("label",[r("b",[e._v("E-mail")]),r("input",{attrs:{id:"email",type:"email",required:""}})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("label",[r("b",[e._v("Senha")]),r("input",{attrs:{id:"password",type:"password",required:""}})])}],d=r(629),u={methods:{...(0,d.nv)("authField",["login"]),requestLogin(e){e.preventDefault(),this.login({email:document.getElementById("email").value,password:document.getElementById("password").value})}}},l=u,v=r(1001),m=(0,v.Z)(l,c,a,!1,null,null,null),h=m.exports,p=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},f=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",[e._v("Home page")])])}],_={data(){return{}}},g=_,k=(0,v.Z)(g,p,f,!1,null,null,null),b=k.exports,R=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h2",[e._v("Filmes")]),r("List",{attrs:{list:e.movies,deleteRecord:e.deleteRecord,edditRecord:e.edditRecord}}),e.edditingMode?r("Item",{attrs:{item:this.movie,saveRecord:e.saveRecord,cancelUpdate:function(){e.edditingMode=!1},updateRecord:e.setMovieUpdate}}):e._e()],1)},D=[],w=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"divList"},[r("table",[r("tr",[r("td",[e._v("Id")]),r("td",[e._v("Nome")]),e.showDirector?r("td",[e._v("Diretor")]):e._e()]),e._l(e.list,(function(t,o){return r("tr",{key:o},[r("td",[e._v(e._s(t.id))]),r("td",[e._v(e._s(t.name))]),e.showDirector?r("td",[e._v(e._s(t.director_name))]):e._e(),r("td",[r("button",{on:{click:function(r){return e.deleteRecord({id:t.id})}}},[e._v("Deletar")])]),r("td",[r("button",{on:{click:function(r){return e.edditRecord({id:t.id})}}},[e._v("Editar")])])])}))],2),r("button",{on:{click:function(t){return e.edditRecord({id:-1})}}},[e._v("Novo item")])])},M=[],y={props:{list:Array,showDirector:{type:Boolean,default:!0},deleteRecord:Function,edditRecord:Function}},L=y,T=(0,v.Z)(L,w,M,!1,null,null,null),E=T.exports,O=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("label",[e._v(" Id "),r("input",{attrs:{type:"numeric",disabled:""},domProps:{value:e.item.id}})]),r("label",[e._v(" Nome "),r("input",{attrs:{type:"text"},domProps:{value:e.item.name},on:{change:function(t){return e.updateRecord({values:{name:t.target.value}})}}})]),e.showDirector?r("label",[e._v(" Diretor "),r("select",{domProps:{value:e.item.director_id},on:{change:function(t){e.updateRecord({values:{director_id:parseInt(t.target.value)}})}}},e._l(e.directors,(function(t,o){return r("option",{key:o,domProps:{value:t.id}},[e._v(e._s(t.name))])})),0)]):e._e(),r("button",{on:{click:function(t){return e.saveRecord()}}},[e._v("Salvar")]),r("button",{on:{click:function(t){return e.cancelUpdate()}}},[e._v("Cancelar")])])},U=[],$={props:{item:Object,showDirector:{type:Boolean,default:!0},saveRecord:Function,cancelUpdate:Function,updateRecord:Function},computed:{...(0,d.rn)("directors",["directors"])}},I=$,x=(0,v.Z)(I,O,U,!1,null,null,null),P=x.exports,Z={mounted(){this.fetchListDirectors({callback:()=>{this.fetchListMovies({directors:this.directors})}})},data(){return{edditingMode:!1}},components:{List:E,Item:P},computed:{...(0,d.rn)("directors",["directors"]),...(0,d.rn)("movies",["movies","movie"])},methods:{...(0,d.nv)("directors",["fetchListDirectors"]),...(0,d.nv)("movies",["fetchListMovies","saveRecordMovies","deleteRecordMovies"]),...(0,d.OI)("movies",["setMovie","setMovieUpdate"]),deleteRecord({id:e}){this.deleteRecordMovies({id:e,callback:()=>{this.fetchListMovies({directors:this.directors})}})},edditRecord({id:e}){this.setMovie({id:e}),this.edditingMode=!0},saveRecord(){this.saveRecordMovies({callback:()=>{this.edditingMode=!1,this.fetchListMovies({directors:this.directors})}})}}},j=Z,F=(0,v.Z)(j,R,D,!1,null,null,null),q=F.exports,S=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h2",[e._v("Diretores")]),r("List",{attrs:{list:e.directors,showDirector:!1,deleteRecord:e.deleteRecord,edditRecord:e.edditRecord}}),e.edditingMode?r("Item",{attrs:{item:e.director,showDirector:!1,saveRecord:e.saveRecord,cancelUpdate:function(){e.edditingMode=!1},updateRecord:e.setDirectorUpdate}}):e._e()],1)},N=[],B={mounted(){this.fetchListDirectors()},data(){return{edditingMode:!1}},components:{List:E,Item:P},computed:{...(0,d.rn)("directors",["directors","director"])},methods:{...(0,d.nv)("directors",["fetchListDirectors","saveRecordDirectors","deleteRecordDirectors"]),...(0,d.OI)("directors",["setDirector","setDirectorUpdate"]),deleteRecord({id:e}){this.deleteRecordDirectors({id:e,callback:()=>{this.fetchListDirectors()}})},edditRecord({id:e}){this.setDirector({id:e}),this.edditingMode=!0},saveRecord(){this.saveRecordDirectors({callback:()=>{this.edditingMode=!1,this.fetchListDirectors()}})}}},C=B,J=(0,v.Z)(C,S,N,!1,null,null,null),A=J.exports;o.Z.use(s.Z);const H=[{path:"/",name:"index",component:b},{path:"/login",name:"login",component:h},{path:"/movies",name:"movies",component:q},{path:"/directors",name:"directos",component:A}],z=new s.Z({mode:"history",base:"/",routes:H});var W=z,G={name:"App",methods:{goToHome(){W.push("/").catch((()=>{}))},goToMovies(){W.push("/movies").catch((()=>{}))},goToDirectors(){W.push("/directors").catch((()=>{}))}}},K=G,Q=(0,v.Z)(K,i,n,!1,null,null,null),V=Q.exports,X=(r(6699),r(9669)),Y=r.n(X),ee={state:{}};const te="/api";var re=({project_id:e,equipment_id:t}={})=>{const r=Y().create({baseURL:te,timeout:3e4,headers:{Authorization:`Bearer ${ee.state.token}`,project_id:e||ee.project_id,equipment_id:t||ee.equipment_id}});return r.interceptors.response.use((e=>e),(async e=>{const t=e.config;if((401===e.response.status||500===e.response.status&&e.response.data.stack.includes("JWTExpired"))&&ee.state.refreshToken){let e=null;return await Y().create({baseURL:te,timeout:5e3}).post("v1/auth/refresh",{refresh_token:ee.state.refreshToken}).then((async({data:r})=>{ee.state.token=r.token,ee.state.refreshToken=r.refreshToken,t.headers.Authorization=`Bearer ${r.token}`,await Y().request(t).then((t=>{e=t})).catch((t=>{e=t}))})).catch((t=>{e=t})),200===e.status||201===e.status?e:Promise.reject(e)}return Promise.reject(e)})),r},oe={namespaced:!0,state:{token:null,refreshToken:null,loginError:null,user:{},email_new:null},actions:{login({commit:e,dispatch:t},{email:r,password:o}){return e("setLoginError",null),re().post("v1/auth/login",{email:r,password:o}).then((({data:r})=>{e("setToken",{token:r.token,refreshToken:r.refreshToken}),t("me",{goToRoot:!0})})).catch((t=>{401===t.response.status?e("setLoginError","Usuário e/ou senha incorretos"):e("setLoginError","Ocorreu um erro ao tentar logar")}))},updateUser({dispatch:e,state:t},{name:r,surname:o,password:i}){return re().patch("v1/auth/update",{name:r,surname:o,password:i}).then((()=>{i?e("login",{email:t.user.email,password:i}):e("me")}))},register({state:e},{institution_id:t}){return!!e.email_new&&re().post("v1/auth/register",{email:e.email_new,password:"123456",institution_id:t})},refreshToken({state:e,commit:t},{callback:r,callbackError:o}){return t("setLoginError",null),re().post("v1/auth/refresh",{refresh_token:e.refreshToken}).then((({data:e})=>{t("setToken",{token:e.token,refreshToken:e.refreshToken}),r&&r()})).catch((e=>{401===e.response.status?t("setLoginError","Usuário e/ou senha incorretos"):t("setLoginError","Ocorreu um erro ao tentar logar"),o&&o()}))},me({commit:e},{goToRoot:t=!1,callback:r}={}){return re().get("v1/auth/me").then((({data:o})=>{e("setUser",o),t&&W.push("/").catch((()=>{})),r&&r()})).catch((()=>{t&&W.push("/login").catch((()=>{}))}))},logout({commit:e}){return re().post("v1/auth/logout").then((()=>{e("setUser",{}),e("setToken",{token:null,refreshToken:null}),W.push("/login").catch((()=>{}))}))},configPivot({commit:e,state:t}){ee.state=new Proxy({},{get:(e,r)=>t[r],set:(t,r,o)=>(e("setPivot",{key:r,value:o}),!0)})}},getters:{isLoggedIn(e){return!!e.refreshToken},getUser(e){return e.user||{}}},mutations:{setLoginError(e,t){e.loginError=t},setUser(e,t){e.user=t},setToken(e,{token:t,refreshToken:r}){e.token=t,e.refreshToken=r},setPivot(e,{key:t,value:r}){e[t]=r},setEmail_new(e,t){e.email_new=t}}},ie={namespaced:!0,state:{movies:[],movie:{}},actions:{fetchListMovies({commit:e},{directors:t}={}){return re().get("MovieItems").then((({data:r})=>{e("setMovies",{data:r,directors:t})}))},saveRecordMovies({state:e},{callback:t}={}){const r=e.movie.id<0?"post":"put",o=JSON.parse(JSON.stringify(e.movie)),i="post"===r?"":`/${o.id}`;return"post"===r&&delete o.id,re()[r](`MovieItems${i}`,o).then((()=>{t&&t()}))},deleteRecordMovies({},{id:e,callback:t}={}){return re().delete(`MovieItems/${e}`).then((()=>{t&&t()}))}},getters:{},mutations:{setMovies(e,{data:t,directors:r}){e.movies.splice(0),t.forEach((e=>{const t=r.find((t=>t.id===e.director_id));t&&(e.director_name=t.name)})),e.movies.push(...t)},setMovie(e,{id:t}){e.movie=e.movies.find((e=>e.id===t))||{id:t}},setMovieUpdate(e,{movie:t,values:r}){const o=t||e.movie;Object.keys(r).forEach((e=>{o[e]=r[e]}))}}},ne={namespaced:!0,state:{directors:[],director:{}},actions:{fetchListDirectors({commit:e},{callback:t}={}){return re().get("DirectorItems").then((({data:r})=>{e("setDirectors",{data:r}),t&&t()}))},saveRecordDirectors({state:e},{callback:t}={}){const r=e.director.id<0?"post":"put",o=JSON.parse(JSON.stringify(e.director)),i="post"===r?"":`/${o.id}`;return"post"===r&&delete o.id,re()[r](`DirectorItems${i}`,o).then((()=>{t&&t()}))},deleteRecordDirectors({},{id:e,callback:t}={}){return re().delete(`DirectorItems/${e}`).then((()=>{t&&t()}))}},getters:{},mutations:{setDirectors(e,{data:t}){e.directors.splice(0),e.directors.push(...t)},setDirector(e,{id:t}){e.director=e.directors.find((e=>e.id===t))||{id:t}},setDirectorUpdate(e,{values:t}){Object.keys(t).forEach((r=>{e.director[r]=t[r]}))}}};o.Z.use(d.ZP);var se=new d.ZP.Store({strict:!0,state:{},modules:{authentication:oe,movies:ie,directors:ne},mutations:{setState(e,{key:t,value:r}){e[t]=r}},actions:{},plugins:[]});o.Z.config.productionTip=!1,new o.Z({router:W,store:se,render:e=>e(V)}).$mount("#app")}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.m=e,function(){var e=[];r.O=function(t,o,i,n){if(!o){var s=1/0;for(u=0;u<e.length;u++){o=e[u][0],i=e[u][1],n=e[u][2];for(var c=!0,a=0;a<o.length;a++)(!1&n||s>=n)&&Object.keys(r.O).every((function(e){return r.O[e](o[a])}))?o.splice(a--,1):(c=!1,n<s&&(s=n));if(c){e.splice(u--,1);var d=i();void 0!==d&&(t=d)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[o,i,n]}}(),function(){r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,{a:t}),t}}(),function(){r.d=function(e,t){for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};r.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,n,s=o[0],c=o[1],a=o[2],d=0;if(s.some((function(t){return 0!==e[t]}))){for(i in c)r.o(c,i)&&(r.m[i]=c[i]);if(a)var u=a(r)}for(t&&t(o);d<s.length;d++)n=s[d],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(u)},o=self["webpackChunkclient"]=self["webpackChunkclient"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=r.O(void 0,[998],(function(){return r(3174)}));o=r.O(o)})();
//# sourceMappingURL=app.c6d5edc0.js.map